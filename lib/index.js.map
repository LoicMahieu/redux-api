{"version":3,"sources":["../src/index.js"],"names":["reduxApi","defaultEndpointConfig","transformer","object","PREFIX","config","baseConfig","fetchHolder","fetch","server","rootUrl","middlewareParser","options","responseHandler","cfg","use","key","value","init","isServer","console","warn","actions","reducers","events","fnConfigCallback","memo","opts","reducerName","url","broadcast","urlOptions","crud","prefetch","postfetch","validation","helpers","prefix","ACTIONS","actionFetch","actionSuccess","actionFail","actionReset","meta","args","apply","holder","virtual","initialState","sync","syncing","loading","data","reducer","bind","Object","keys","reduce","transformers","async"],"mappings":"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","file":"index.js","sourcesContent":["\"use strict\";\n\n/* eslint no-void: 0 */\n\nimport reducerFn from \"./reducerFn\";\nimport actionFn from \"./actionFn\";\nimport transformers from \"./transformers\";\nimport async from \"./async\";\n\n// export { transformers, async };\n\n/**\n * Default configuration for each endpoint\n * @type {Object}\n */\nconst defaultEndpointConfig = {\n  transformer: transformers.object\n};\n\nconst PREFIX = \"@@redux-api\";\n/**\n * Entry api point\n * @param {Object} config Rest api configuration\n * @param {Object} baseConfig baseConfig settings for Rest api\n * @param {Function} fetch Adapter for rest requests\n * @param {Boolean} isServer false by default (fif you want to use it for isomorphic apps)\n * @return {actions, reducers}        { actions, reducers}\n * @example ```js\n *   const api = reduxApi({\n *     test: \"/plain/url\",\n *     testItem: \"/plain/url/:id\",\n *     testModify: {\n *       url: \"/plain/url/:endpoint\",\n\n *       transformer: (data)=> !data ?\n *          { title: \"\", message: \"\" } :\n *          { title: data.title, message: data.message },\n *       options: {\n *         method: \"post\"\n *         headers: {\n *           \"Accept\": \"application/json\",\n *           \"Content-Type\": \"application/json\"\n *         }\n *       }\n *     }\n *   });\n *   // register reducers\n *\n *   // call actions\n *   dispatch(api.actions.test());\n *   dispatch(api.actions.testItem({id: 1}));\n *   dispatch(api.actions.testModify({endpoint: \"upload-1\"}, {\n *     body: JSON.stringify({title: \"Hello\", message: \"World\"})\n *   }));\n * ```\n */\n\nexport default function reduxApi(config, baseConfig) {\n  config || (config = {});\n\n  const fetchHolder = {\n    fetch: null,\n    server: false,\n    rootUrl: null,\n    middlewareParser: null,\n    options: {},\n    responseHandler: null\n  };\n\n  const cfg = {\n    use(key, value) {\n      fetchHolder[key] = value;\n\n      return this;\n    },\n    init(fetch, isServer=false, rootUrl) {\n      /* eslint no-console: 0 */\n      console.warn(\"Deprecated method, use `use` method\");\n      this.use(\"fetch\", fetch);\n      this.use(\"server\", isServer);\n      this.use(\"rootUrl\", rootUrl);\n      return this;\n    },\n    actions: {},\n    reducers: {},\n    events: {}\n  };\n  function fnConfigCallback(memo, value, key) {\n    const opts = typeof value === \"object\" ?\n      { ...defaultEndpointConfig, reducerName: key, ...value } :\n      { ...defaultEndpointConfig, reducerName: key, url: value };\n\n    if (opts.broadcast !== (void 0)) {\n      /* eslint no-console: 0 */\n      console.warn(\"Deprecated `broadcast` option. you shoud use `events`\" +\n      \"to catch redux-api events (see https://github.com/lexich/redux-api/blob/master/DOCS.md#Events)\");\n    }\n\n    const {\n      url, urlOptions, options, transformer, broadcast, crud,\n      reducerName, prefetch, postfetch, validation, helpers,\n    } = opts;\n\n    const prefix = (baseConfig && baseConfig.prefix) || \"\";\n\n    const ACTIONS = {\n      actionFetch: `${PREFIX}@${prefix}${reducerName}`,\n      actionSuccess: `${PREFIX}@${prefix}${reducerName}_success`,\n      actionFail: `${PREFIX}@${prefix}${reducerName}_fail`,\n      actionReset: `${PREFIX}@${prefix}${reducerName}_delete`\n    };\n\n    const meta = {\n      urlOptions,\n      fetch: opts.fetch ? opts.fetch : function(...args) {\n        return fetchHolder.fetch.apply(this, args);\n      },\n      holder: fetchHolder,\n      broadcast,\n      virtual: !!opts.virtual,\n      reducerName,\n      actions: memo.actions,\n      prefetch,\n      postfetch,\n      validation,\n      helpers,\n      transformer,\n      prefix,\n      crud\n    };\n\n    memo.actions[key] = actionFn(url, key, options, ACTIONS, meta);\n\n    if (!meta.virtual && !memo.reducers[reducerName]) {\n      const initialState = {\n        sync: false,\n        syncing: false,\n        loading: false,\n        data: transformer()\n      };\n      const reducer = opts.reducer ? opts.reducer.bind(memo) : null;\n      memo.reducers[reducerName] = reducerFn(initialState, ACTIONS, reducer);\n    }\n    memo.events[reducerName] = ACTIONS;\n    return memo;\n  }\n\n  return Object.keys(config).reduce(\n    (memo, key)=> fnConfigCallback(memo, config[key], key, config), cfg);\n}\n\nreduxApi.transformers = transformers;\nreduxApi.async = async;\n"]}